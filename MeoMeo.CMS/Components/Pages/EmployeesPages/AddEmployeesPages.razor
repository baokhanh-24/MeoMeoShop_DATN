@page "/add-employees-pages"
@using System.ComponentModel.DataAnnotations
@using System.Reflection
@using MeoMeo.Contract.DTOs
@using MeoMeo.Shared.IServices;
@using MeoMeo.Contract.Commons
@using MeoMeo.Domain.Commons.Enums
@using ButtonType = AntDesign.ButtonType
@inject MeoMeo.Shared.Utilities.MessageModalService MessageModalService
@rendermode InteractiveServer

@if (Visible)
{
    <Modal Title="Thêm mới nhân viên" Visible="true" OnCancel="OnCancel" Footer="null" Width="800">
        <Form Model="@employee" OnFinish="HandleValidSubmit" Layout="@FormLayout.Vertical">
            <div class="row">
                <div class="col-md-12">
                    <FormItem Label="Họ và tên" Required>
                        <Input @bind-Value="employee.Name" Placeholder="Nhập họ và tên" MaxLength="100" />
                    </FormItem>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <FormItem Label="Số điện thoại" Required>
                        <Input @bind-Value="employee.PhoneNumber" Placeholder="Nhập số điện thoại" MaxLength="12" />
                    </FormItem>
                </div>
                <div class="col-md-6">
                    <FormItem Label="Email">
                        <Input @bind-Value="employee.Email" Placeholder="Nhập email" />
                    </FormItem>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <FormItem Label="Ngày sinh">
                        <DatePicker Style="width: 100%" @bind-Value="employee.DateOfBird" />
                    </FormItem>
                </div>
                <div class="col-md-6">
                    <FormItem Label="Trạng thái" Required>
                        <Select TItem="(EEmployeesStatus Value, string Name)" TItemValue="EEmployeesStatus"
                            @bind-Value="employee.StatusEnum" DataSource="StatusList" ItemValue="item => item.Value"
                            ItemLabel="item => item.Name" Placeholder="Chọn trạng thái">
                        </Select>
                    </FormItem>
                </div>
            </div>

            <FormItem Label="Địa chỉ">
                <TextArea @bind-Value="employee.Address" Placeholder="Nhập địa chỉ" Rows="3" MaxLength="255" />
            </FormItem>

            <FormItem Label="Mật khẩu" Required>
                <Input @bind-Value="employee.Password" Placeholder="Nhập mật khẩu" Password="true" />
            </FormItem>

            <div class="text-end">
                <Button OnClick="OnCancel" Type="ButtonType.Default" Class="me-2">Hủy</Button>
                <Button Type="ButtonType.Primary" HtmlType="submit">Lưu</Button>
            </div>
        </Form>
    </Modal>
}

@code {
    [Parameter] public bool Visible { get; set; }
    [Parameter] public EventCallback<bool> VisibleChanged { get; set; }
    [Parameter] public EventCallback<CreateOrUpdateEmployeeDTO> OnSave { get; set; }

    private CreateOrUpdateEmployeeDTO employee = new();

    [Parameter] public List<(EEmployeesStatus Value, string Name)> StatusList { get; set; }

    protected override async Task OnInitializedAsync()
    {
        employee.Status = 1;
    }

    private async Task HandleValidSubmit()
    {
        await OnSave.InvokeAsync(employee);
        await InvokeAsync(StateHasChanged);
        ResetForm();
    }

    private void ResetForm()
    {
        employee = new CreateOrUpdateEmployeeDTO();
    }

    private async Task OnCancel()
    {
        await VisibleChanged.InvokeAsync(false);
    }
}